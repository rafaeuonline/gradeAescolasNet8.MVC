@using Microsoft.AspNetCore.Http
@using System.Globalization
@inject IHttpContextAccessor HttpContextAccessor

@{
    var isAuthenticated = HttpContextAccessor.HttpContext?.User?.Identity?.IsAuthenticated ?? false;
}

@if (isAuthenticated)
{
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Descrição do GradeA Escolas">
        <meta name="keywords" content="palavras, chaves, gradeaescolas">
        <meta name="author" content="DpDigital">
        <link rel="icon" href="/assets/images/favicon.png" type="image/x-icon" asp-append-version="true">
        <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/x-icon" asp-append-version="true">
        <title>Zono - Premium Admin Template</title>
        <!-- Google font -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
        <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@200;300;400;600;700;800;900&amp;display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900&amp;display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/assets/css/font-awesome.css" asp-append-version="true">
        <!-- ico-font-->
        <link rel="stylesheet" type="text/css" href="/assets/css/vendors/icofont.css" asp-append-version="true">
        <!-- Themify icon-->
        <link rel="stylesheet" type="text/css" href="/assets/css/vendors/themify.css" asp-append-version="true">
        <!-- Flag icon-->
        <link rel="stylesheet" type="text/css" href="/assets/css/vendors/flag-icon.css" asp-append-version="true">
        <!-- Feather icon-->
        <link rel="stylesheet" type="text/css" href="/assets/css/vendors/feather-icon.css" asp-append-version="true">
        <!-- Plugins css start-->
        <link rel="stylesheet" type="text/css" href="/assets/css/vendors/slick.css" asp-append-version="true">
        <link rel="stylesheet" type="text/css" href="/assets/css/vendors/slick-theme.css" asp-append-version="true">
        <link rel="stylesheet" type="text/css" href="/assets/css/vendors/scrollbar.css" asp-append-version="true">
        <link rel="stylesheet" type="text/css" href="/assets/css/vendors/animate.css" asp-append-version="true">
        <link rel="stylesheet" type="text/css" href="/assets/css/vendors/datatables.css" asp-append-version="true">
        <link rel="stylesheet" type="text/css" href="/assets/css/vendors/owlcarousel.css" asp-append-version="true">
        <!-- Plugins css Ends-->
        <!-- Bootstrap css-->
        <link rel="stylesheet" type="text/css" href="/assets/css/vendors/bootstrap.css" asp-append-version="true">
        <!-- App css-->
        <link rel="stylesheet" type="text/css" href="/assets/css/style.css" asp-append-version="true">
        <link id="color" rel="stylesheet" href="/assets/css/color-1.css" asp-append-version="true" media="screen">
        <!-- Responsive css-->
        <link rel="stylesheet" type="text/css" href="/assets/css/responsive.css" asp-append-version="true">
      </head>
      <body> 
        <!-- loader starts-->
        <div class="loader-wrapper">
          <div class="theme-loader">    
            <div class="loader-p"></div>
          </div>
        </div>
        <!-- loader ends-->
        <!-- tap on top starts-->
        <div class="tap-top"><i data-feather="chevrons-up"></i></div>
        <!-- tap on tap ends-->
        <!-- page-wrapper Start   -->
        <div class="page-wrapper compact-wrapper" id="pageWrapper">
          <!-- Page Header Start-->

          @await Html.PartialAsync("_TopoPartial")

          <!-- Page Header Ends                              -->
          <!-- Page body Start -->
          <div class="page-body-wrapper"> 
            <!-- Page Sidebar Start-->
                <div class="sidebar-wrapper" data-layout="stroke-svg">
                    <div>
                        <div class="logo-wrapper">
                            <a href="/"> <img class="img-fluid for-light" src="/assets/images/logo/logo.png" alt=""><img class="img-fluid for-dark" src="/assets/images/logo/logo_dark.png" alt=""></a>
                            <div class="toggle-sidebar">
                                <svg class="sidebar-toggle">
                                    <use href="/assets/svg/icon-sprite.svg#toggle-icon"></use>
                                </svg>
                            </div>
                        </div>
                        <div class="logo-icon-wrapper"><a href="/"><img class="img-fluid" src="/assets/images/logo/logo-icon.png" alt=""></a></div>
                        <nav class="sidebar-main">
                            <div class="left-arrow" id="left-arrow"><i data-feather="arrow-left"></i></div>
                            <div id="sidebar-menu">
                                <ul class="sidebar-links" id="simple-bar">
                                    <li class="back-btn">
                                        <a href="/"><img class="img-fluid" src="/assets/images/logo/logo-icon.png" alt=""></a>
                                        <div class="mobile-back text-end"><span>Back</span><i class="fa fa-angle-right ps-2" aria-hidden="true"></i></div>
                                    </li>

                                    @await Html.PartialAsync("_MenuEsquerdoPartial")

                                </ul>
                            </div>
                            <div class="right-arrow" id="right-arrow"><i data-feather="arrow-right"></i></div>
                        </nav>
                    </div>
                </div>

            <!-- Page Sidebar Ends-->
            <div class="page-body">
              <div class="container-fluid">
                <div class="page-title"> 
                  <div class="row">
                    <div class="col-xl-4 col-sm-7 box-col-3">
                      @* <h3>Default Dashboard</h3> *@
                                    @{
                                        var nomeUsuario = Context.Session.GetString("UserName");
                                        var nomeFormatado = !string.IsNullOrEmpty(nomeUsuario)
                                        ? CultureInfo.CurrentCulture.TextInfo.ToTitleCase(nomeUsuario.ToLower())
                                        : "Usuário";

                                        var role = Context.Session.GetString("Role");
                                        var empresaId = Context.Session.GetString("EmpresaId");

                                        var pessoaId = @Context.Session.GetString("PessoaId");
                                        //var tokenExpiration = @DateTime.Parse(Context.Session.GetString("TokenExpiration"));
                                        
                                        var expirationString = Context.Session.GetString("TokenExpiration");
                                        DateTime? tokenExpiration = null;

                                        if (!string.IsNullOrEmpty(expirationString) && DateTime.TryParse(expirationString, out var parsedDate))
                                        {
                                            tokenExpiration = parsedDate;

                                            var tokenExpirationFormatado = tokenExpiration.Value.ToString("dd/MM/yyyy HH:mm:ss");
                                        }
                                        
                                        
                                    }
                                    @{
                                        var rolesJson = Context.Session.GetString("Roles");
                                        List<string> roles = new();

                                        if (!string.IsNullOrEmpty(rolesJson))
                                        {
                                            roles = System.Text.Json.JsonSerializer.Deserialize<List<string>>(rolesJson);
                                        }
                                    }


                                    @if (!string.IsNullOrEmpty(nomeUsuario))
                                    {
                                       // <div class="text-end me-3 p-2">
                                        <span class="text-muted">Bem-vindo, <strong>@nomeFormatado</strong>
                                            | PId: @pessoaId/EId: @empresaId
                                            | Role(s): @string.Join(", ", roles)
                                            <BR />Sua sessão expira em: @tokenExpiration
                                        </span>
                                        //</div>
                                    }

                    </div>
                    <div class="col-5 d-none d-xl-block">
                      <!-- Page Sub Header Start-->

                      @await Html.PartialAsync("_MenuTopoPartial")
                  
                      <!-- Page Sub Header end
                      -->
                    </div>
                    <div class="col-xl-3 col-sm-5 box-col-4">
                      @* <ol class="breadcrumb"> 
                        <li class="breadcrumb-item"><a href="/">
                            <svg class="stroke-icon">
                              <use href="/assets/svg/icon-sprite.svg#stroke-home"></use>
                            </svg></a></li>
                        <li class="breadcrumb-item">Dashboard</li>
                        <li class="breadcrumb-item active">Default</li>
                      </ol> *@
                      <!-- BreadCrumb Dinâmico-->
                      @await Component.InvokeAsync("Breadcrumb")
                    </div>
                  </div>
                </div>
              </div>
              <!-- Container-fluid starts-->

                <!-- MAIN Conteúdo aqui INÍCIO -->
                @RenderBody()
                <!-- MAIN Conteúdo aqui FIM  -->

              <!-- Container-fluid Ends-->
            </div>
            <!-- footer start-->
            <footer class="footer">
              <div class="container-fluid">
                <div class="row">
                  <div class="col-md-6 p-0 footer-copyright">
                    <p class="mb-0">Copyright 2025 © GradeA Escolas.</p>
                  </div>
                  <div class="col-md-6 p-0">
                    <p class="heart mb-0">Desenvolvido &amp; criado com
                      <svg class="footer-icon">
                        <use href="/assets/svg/icon-sprite.svg#heart"></use>
                      </svg>
                    </p>
                  </div>
                </div>
              </div>
            </footer>
          </div>
        </div>
        <!-- latest jquery-->
        <script src="/assets/js/jquery.min.js" asp-append-version="true"></script>
        <!-- Bootstrap js-->
        <script src="/assets/js/bootstrap/bootstrap.bundle.min.js" asp-append-version="true"></script>
        <!-- feather icon js-->
        <script src="/assets/js/icons/feather-icon/feather.min.js" asp-append-version="true"></script>
        <script src="/assets/js/icons/feather-icon/feather-icon.js" asp-append-version="true"></script>
        <!-- scrollbar js-->
        <script src="/assets/js/scrollbar/simplebar.js" asp-append-version="true"></script>
        <script src="/assets/js/scrollbar/custom.js" asp-append-version="true"></script>
        <!-- Sidebar jquery-->
        <script src="/assets/js/config.js" asp-append-version="true"></script>
        <!-- Plugins JS start-->
        <script src="/assets/js/sidebar-menu.js" asp-append-version="true"></script>
        <script src="/assets/js/sidebar-pin.js" asp-append-version="true"></script>
        <script src="/assets/js/slick/slick.min.js" asp-append-version="true"></script>
        <script src="/assets/js/slick/slick.js" asp-append-version="true"></script>
        <script src="/assets/js/header-slick.js" asp-append-version="true"></script>
        <script src="/assets/js/chart/morris-chart/raphael.js" asp-append-version="true"></script>
        <script src="/assets/js/chart/morris-chart/morris.js" asp-append-version="true"> </script>
        <script src="/assets/js/chart/morris-chart/prettify.min.js" asp-append-version="true"></script>
        <script src="/assets/js/chart/apex-chart/apex-chart.js" asp-append-version="true"></script>
        <script src="/assets/js/chart/apex-chart/stock-prices.js" asp-append-version="true"></script>
        <script src="/assets/js/chart/apex-chart/moment.min.js" asp-append-version="true"></script>
        <script src="/assets/js/notify/bootstrap-notify.min.js" asp-append-version="true"></script>
        <script src="/assets/js/dashboard/default.js" asp-append-version="true"></script>
        <script src="/assets/js/notify/index.js" asp-append-version="true"></script>
        <script src="/assets/js/datatable/datatables/jquery.dataTables.min.js" asp-append-version="true"></script>
        <script src="/assets/js/datatable/datatables/datatable.custom.js" asp-append-version="true"></script>
        <script src="/assets/js/datatable/datatables/datatable.custom1.js" asp-append-version="true"></script>
        <script src="/assets/js/owlcarousel/owl.carousel.js" asp-append-version="true"></script>
        <script src="/assets/js/owlcarousel/owl-custom.js" asp-append-version="true"></script>
        <script src="/assets/js/typeahead/handlebars.js" asp-append-version="true"></script>
        <script src="/assets/js/typeahead/typeahead.bundle.js" asp-append-version="true"></script>
        <script src="/assets/js/typeahead/typeahead.custom.js" asp-append-version="true"></script>
        <script src="/assets/js/typeahead-search/handlebars.js" asp-append-version="true"></script>
        <script src="/assets/js/typeahead-search/typeahead-custom.js" asp-append-version="true"></script>
        <script src="/assets/js/height-equal.js" asp-append-version="true"></script>
        <!-- Plugins JS Ends-->
        <!-- Theme js-->
        <script src="/assets/js/script.js" asp-append-version="true"></script>
        <script src="/assets/js/theme-customizer/customizer.js" asp-append-version="true"></script>
        <!-- Plugin used-->
        @RenderSection("Scripts", required: false)
      </body>
    </html>
}
else
{
    <!-- Não renderiza layout se não estiver autenticado -->
    @RenderBody()
}